<!DOCTYPE HTML>
<html lang="en" class="light" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Maintain a valid session - Codename SCNR Documentation</title>


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body class="sidebar-visible no-js">
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('light')
            html.classList.add(theme);
            var body = document.querySelector('body');
            body.classList.remove('no-js')
            body.classList.add('js');
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var body = document.querySelector('body');
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            body.classList.remove('sidebar-visible');
            body.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="../index.html">Introduction</a></li><li class="chapter-item expanded affix "><a href="../installation.html">Installation</a></li><li class="chapter-item expanded affix "><a href="../system-requirements.html">System requirements</a></li><li class="chapter-item expanded affix "><li class="part-title">Deployment</li><li class="chapter-item expanded "><a href="../deployment/direct.html"><strong aria-hidden="true">1.</strong> Direct</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../deployment/scripted.html"><strong aria-hidden="true">1.1.</strong> Scripted</a></li></ol></li><li class="chapter-item expanded "><a href="../deployment/distributed/index.html"><strong aria-hidden="true">2.</strong> Distributed</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../deployment/distributed/agent.html"><strong aria-hidden="true">2.1.</strong> Agent</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../deployment/distributed/agent/grid.html"><strong aria-hidden="true">2.1.1.</strong> Grid</a></li></ol></li><li class="chapter-item expanded "><a href="../deployment/distributed/scheduler.html"><strong aria-hidden="true">2.2.</strong> Scheduler</a></li></ol></li><li class="chapter-item expanded "><a href="../deployment/introspector/index.html"><strong aria-hidden="true">3.</strong> Introspector</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../deployment/introspector/ruby.html"><strong aria-hidden="true">3.1.</strong> Ruby</a></li><li class="chapter-item expanded "><a href="../deployment/introspector/java.html"><strong aria-hidden="true">3.2.</strong> Java</a></li><li class="chapter-item expanded "><a href="../deployment/introspector/dotnet.html"><strong aria-hidden="true">3.3.</strong> .NET</a></li></ol></li><li class="chapter-item expanded "><li class="part-title">Interfaces</li><li class="chapter-item expanded "><a href="../interfaces/cli.html"><strong aria-hidden="true">4.</strong> CLI</a></li><li class="chapter-item expanded "><a href="../interfaces/ruby-api/index.html"><strong aria-hidden="true">5.</strong> Ruby API</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../interfaces/ruby-api/data/index.html"><strong aria-hidden="true">5.1.</strong> Data</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../interfaces/ruby-api/data/sitemap.html"><strong aria-hidden="true">5.1.1.</strong> Sitemap</a></li><li class="chapter-item expanded "><a href="../interfaces/ruby-api/data/urls.html"><strong aria-hidden="true">5.1.2.</strong> Urls</a></li><li class="chapter-item expanded "><a href="../interfaces/ruby-api/data/pages.html"><strong aria-hidden="true">5.1.3.</strong> Pages</a></li><li class="chapter-item expanded "><a href="../interfaces/ruby-api/data/issues.html"><strong aria-hidden="true">5.1.4.</strong> Issues</a></li></ol></li><li class="chapter-item expanded "><a href="../interfaces/ruby-api/state.html"><strong aria-hidden="true">5.2.</strong> State</a></li><li class="chapter-item expanded "><a href="../interfaces/ruby-api/browserpool.html"><strong aria-hidden="true">5.3.</strong> Browserpool</a></li><li class="chapter-item expanded "><a href="../interfaces/ruby-api/dom.html"><strong aria-hidden="true">5.4.</strong> Dom</a></li><li class="chapter-item expanded "><a href="../interfaces/ruby-api/http.html"><strong aria-hidden="true">5.5.</strong> Http</a></li><li class="chapter-item expanded "><a href="../interfaces/ruby-api/input.html"><strong aria-hidden="true">5.6.</strong> Input</a></li><li class="chapter-item expanded "><a href="../interfaces/ruby-api/logging.html"><strong aria-hidden="true">5.7.</strong> Logging</a></li><li class="chapter-item expanded "><a href="../interfaces/ruby-api/checks.html"><strong aria-hidden="true">5.8.</strong> Checks</a></li><li class="chapter-item expanded "><a href="../interfaces/ruby-api/plugins.html"><strong aria-hidden="true">5.9.</strong> Plugins</a></li><li class="chapter-item expanded "><a href="../interfaces/ruby-api/fingerprinters.html"><strong aria-hidden="true">5.10.</strong> Fingerprinters</a></li><li class="chapter-item expanded "><a href="../interfaces/ruby-api/scan/index.html"><strong aria-hidden="true">5.11.</strong> Scan</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../interfaces/ruby-api/scan/options.html"><strong aria-hidden="true">5.11.1.</strong> Options</a></li><li class="chapter-item expanded "><a href="../interfaces/ruby-api/scan/scope.html"><strong aria-hidden="true">5.11.2.</strong> Scope</a></li><li class="chapter-item expanded "><a href="../interfaces/ruby-api/scan/session.html"><strong aria-hidden="true">5.11.3.</strong> Session</a></li></ol></li></ol></li><li class="chapter-item expanded "><a href="../interfaces/rest-api/index.html"><strong aria-hidden="true">6.</strong> REST API</a></li><li class="chapter-item expanded "><a href="../interfaces/web/index.html"><strong aria-hidden="true">7.</strong> Web UI</a></li><li class="chapter-item expanded affix "><li class="part-title">How to</li><li class="chapter-item expanded "><a href="../how-to/generate-reports.html"><strong aria-hidden="true">8.</strong> Generate reports</a></li><li class="chapter-item expanded "><a href="../how-to/optimize-scans.html"><strong aria-hidden="true">9.</strong> Optimize scans</a></li><li class="chapter-item expanded "><a href="../how-to/maintain-a-valid-session.html" class="active"><strong aria-hidden="true">10.</strong> Maintain a valid session</a></li><li class="chapter-item expanded "><a href="../how-to/scan-services.html"><strong aria-hidden="true">11.</strong> Scan services</a></li><li class="chapter-item expanded "><a href="../how-to/scale.html"><strong aria-hidden="true">12.</strong> Scale</a></li><li class="chapter-item expanded affix "><a href="../COPYING.html">Copyright</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <!-- Track and set sidebar scroll position -->
        <script>
            var sidebarScrollbox = document.querySelector('#sidebar .sidebar-scrollbox');
            sidebarScrollbox.addEventListener('click', function(e) {
                if (e.target.tagName === 'A') {
                    sessionStorage.setItem('sidebar-scroll', sidebarScrollbox.scrollTop);
                }
            }, { passive: true });
            var sidebarScrollTop = sessionStorage.getItem('sidebar-scroll');
            sessionStorage.removeItem('sidebar-scroll');
            if (sidebarScrollTop) {
                // preserve sidebar scroll position when navigating via links within sidebar
                sidebarScrollbox.scrollTop = sidebarScrollTop;
            } else {
                // scroll sidebar to current active section when navigating via "next/previous chapter" buttons
                var activeSection = document.querySelector('#sidebar .active');
                if (activeSection) {
                    activeSection.scrollIntoView({ block: 'center' });
                }
            }
        </script>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Codename SCNR Documentation</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="maintain-a-valid-session"><a class="header" href="#maintain-a-valid-session">Maintain a valid session</a></h1>
<p>Codename SCNR supports automated logout detection and re-login, as well as improved login procedures.</p>
<ul>
<li><a href="#login_form-plugin">Form-based login</a></li>
<li><a href="#login_script-plugin">Script-based login</a></li>
<li><a href="#proxy-plugin">Proxy-based login</a></li>
<li><a href="#cookie-jar">Cookie-jar login</a></li>
</ul>
<h2 id="login_form-plugin"><a class="header" href="#login_form-plugin">login_form plugin</a></h2>
<p>The <code>login_form</code> plugin expects for following options:</p>
<ul>
<li><code>url</code> – The URL containing the login form;</li>
<li><code>parameters</code> – A URL-query-like string of form parameters;</li>
<li><code>check</code> – A pattern to be matched against the response body after requesting
the supplied URL in order to verify a successful login.</li>
</ul>
<p>After a successful login, the plugin will configure the system-wide session manager
and let it know of the procedure it needs to follow in order to be able to login
automatically, in case it gets logged out during the scan or the session expires.</p>
<p><strong>Hint:</strong> If the response of the form submission doesn’t contain the <code>check</code>,
you can set a different check URL via the global <code>--session-check-url</code> option,
this will also require that a <code>--session-check-pattern</code> be set as well (it can
be the same as the autologin <code>check</code> option).</p>
<h3 id="limitations"><a class="header" href="#limitations">Limitations</a></h3>
<p>This plugin operates a browser just like a regular user would and is thus limited
to the same extent.</p>
<p>For example, if the login form is by default hidden and requires a sequence of UI
interactions in order to become visible, this plugin will not be able to submit it.</p>
<p>For more complex sequences please use the <a href="#login_script-plugin">login_script</a> plugin.</p>
<h3 id="example"><a class="header" href="#example">Example</a></h3>
<pre><code>bin/scnr http://testfire.net --plugin=login_form:url=http://testfire.net/bank/login.aspx,parameters="uid=jsmith&amp;passw=Demo1234",check="Sign Off|MY ACCOUNT" --scope-exclude-pattern=logout
</code></pre>
<p>The login form found in <code>http://testfire.net/bank/login.aspx</code> which contains the
<code>uid</code> and <code>passw</code> inputs will be <strong>updated</strong> with the given values and submitted.</p>
<p>After that, the response will be matched against the <code>check</code> pattern – which will
also be used for the duration of the scan to check whether or not the session is still valid.</p>
<p>(Since the “Sign Off” and “MY ACCOUNT” strings only appear when the user is logged-in,
they are a reliable way to check the validity of the session.)</p>
<p>Lastly, we <strong>exclude</strong> (<code>--scope-exclude-pattern</code>) the logout link from the audit in order to avoid getting logged out.</p>
<h2 id="login_script-plugin"><a class="header" href="#login_script-plugin">login_script plugin</a></h2>
<p>The <code>login_script</code> plugin can be used to specify custom login procedures, as simple
Ruby or JS scripts, to be executed prior to the scan and each time a logout is detected.</p>
<p>The script will be run under the context of a plugin, which means that it will
have access to all system components, allowing you to login in the most optimal
way – be that via a real browser, via HTTP requests, by loading an external
cookie-jar file and many more.</p>
<h3 id="with-browser"><a class="header" href="#with-browser">With browser</a></h3>
<p>If a <a href="http://watir.com/">browser</a> is available, it will be exposed to the script
via the <code>browser</code> variable. Otherwise, that variable will have a value of <code>nil</code>.</p>
<p>If you require access to Selenium, <code>browser.wd</code> will provide you access to the appropriate <code>WebDriver</code>.</p>
<pre><code class="language-ruby">browser.goto 'http://testfire.net/bank/login.aspx'

form = browser.form( id: 'login' )
form.text_field( name: 'uid' ).set 'jsmith'
form.text_field( name: 'passw' ).set 'Demo1234'

form.submit

# You can also configure the session check from the script, dynamically,
# if you don't want to set static options via the user interface.
SCNR::Engine::Options.session.check_url     = browser.url
SCNR::Engine::Options.session.check_pattern = /Sign Off|MY ACCOUNT/
</code></pre>
<h3 id="with-http-client"><a class="header" href="#with-http-client">With HTTP Client</a></h3>
<p>If a real browser environment is not required for the login operation, then using
the system-wide HTTP interface is preferable, as it will be much faster and consume
much less resources.</p>
<pre><code class="language-ruby">response = http.post( 'http://testfire.net/bank/login.aspx',
    parameters:     {
        'uid'   =&gt; 'jsmith',
        'passw' =&gt; 'Demo1234'
    },
    mode:           :sync,
    update_cookies: true
)

SCNR::Engine::Options.session.check_url     = to_absolute( response.headers.location, response.url )
SCNR::Engine::Options.session.check_pattern = /Sign Off|MY ACCOUNT/
</code></pre>
<h3 id="from-cookie-jar"><a class="header" href="#from-cookie-jar">From cookie-jar</a></h3>
<p>If an external process is used to manage sessions, you can keep SCNR in sync by
loading cookies from a shared Netscape-style cookie-jar file.</p>
<pre><code class="language-ruby">http.cookie_jar.load 'cookies.txt'
</code></pre>
<h3 id="advanced-session-check-configuration"><a class="header" href="#advanced-session-check-configuration">Advanced session check configuration</a></h3>
<p>In addition to just setting the <code>check_url</code> and <code>check_pattern</code> options, you can
also set arbitrary HTTP request options for the login check, to cover cases where
extra tokens or a method other than <code>GET</code> must be used.</p>
<pre><code class="language-ruby">framework.session.check_options = {
    # :get, :post, :put, :delete
    method:     :post,

    # URL query parameters.
    parameters: {
        'param1' =&gt; 'value'
    },

    # Request body parameters -- can also be a String instead of Hash.
    body:       {
        'body_param1' =&gt; 'value'
    },

    cookies:    {
        'custom_cookie' =&gt; 'value'
    },

    headers:    {
        'X-Custom-Header' =&gt; 'value'
    }
}
</code></pre>
<h2 id="proxy-plugin"><a class="header" href="#proxy-plugin">Proxy plugin</a></h2>
<p>The <code>proxy</code> plugin can be used to train the system by inspecting the traffic
exchanged between the browser and the web application. From that traffic, it can
extract input vectors like links, forms and cookies from both sides – i.e. from
server responses as well as browser requests.</p>
<p>Since the proxy can inspect all this traffic, it can be instructed to record a
login sequence and then deduce the login form and the values with which it was filled.</p>
<p>Like the <code>form_login</code> plugin, the <code>proxy</code> plugin will configure the system accordingly.</p>
<h3 id="example-1"><a class="header" href="#example-1">Example</a></h3>
<pre><code>bin/scnr http://testfire.net --plugin=proxy --scope-exclude-pattern=logout
</code></pre>
<p>You then need to configure your browser to use this proxy when connecting to the
webapp, press the <em>record</em> button just before logging in and the <em>stop</em> button after.</p>
<p>You’ll then be presented with a simple wizard which will guide you through configuring
a login check and verifying that the deduced login sequence works properly.</p>
<p>Lastly, we <strong>exclude</strong> (<code>--scope-exclude-pattern=logout</code>) the logout link from the audit in order to avoid getting logged out.</p>
<h2 id="cookie-jar"><a class="header" href="#cookie-jar">Cookie-jar</a></h2>
<p>If the aforementioned techniques don’t work for you, you can pass a cookie-jar and manually configure the login-check using the following options:</p>
<ul>
<li><code>--http-cookie-jar</code></li>
<li><code>--session-check-url</code></li>
<li><code>--session-check-pattern</code></li>
</ul>
<p>This way SCNR will still be able to know if it gets logged out (which is helpful to several system components) but won’t be able to log-in automatically.</p>
<p>Of course, you should still exclude any path that can lead to the destruction of the session.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../how-to/optimize-scans.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../how-to/scan-services.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../how-to/optimize-scans.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../how-to/scan-services.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr.min.js"></script>
        <script src="../mark.min.js"></script>
        <script src="../searcher.js"></script>

        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
